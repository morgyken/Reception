var width=320;var height=0;var streaming=false;var video=null;var canvas=null;var photo=null;var startbutton=null;var streams=null;var IMAGE_SRC=null;function startup(){video=document.getElementById("video");canvas=document.getElementById("canvas");photo=document.getElementById("thephoto");startbutton=document.getElementById("startbutton");navigator.getMedia=(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia);navigator.getMedia({video:true,audio:false},function(b){streams=b;if(navigator.mozGetUserMedia){video.mozSrcObject=b}else{var a=window.URL||window.webkitURL;video.src=a.createObjectURL(b)}video.play()},function(a){console.log("An error occured! "+a)});video.addEventListener("canplay",function(a){if(!streaming){height=video.videoHeight/(video.videoWidth/width);if(isNaN(height)){height=width/(4/3)}video.setAttribute("width",width);video.setAttribute("height",height);canvas.setAttribute("width",width);canvas.setAttribute("height",height);streaming=true}},false);startbutton.addEventListener("click",function(a){takepicture();a.preventDefault()},false);clearphoto()}function clearphoto(){}function close_webcam(){if(streaming){var a=streams.getTracks()[0];a.stop();streaming=false}}function takepicture(){var a=canvas.getContext("2d");if(width&&height){canvas.width=width;canvas.height=height;a.drawImage(video,0,0,width,height);IMAGE_SRC=canvas.toDataURL("image/png");photo.setAttribute("src",IMAGE_SRC);$("#goodPhoto").show()}else{clearphoto()}};